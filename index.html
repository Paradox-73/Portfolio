<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="assets/profile.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanav here</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Reset and Body */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #2c2c2c; /* Dark background outside the room */
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent scrolling if possible */
        }

        /* The Room Container 
           This maintains the aspect ratio of the room and scales with the browser window.
        */
        #room-container {
            position: relative;
            width:100vw;
            aspect-ratio: 16/9; /* Standard widescreen aspect ratio */
            background-color: #e0d5c1; /* Fallback wall color */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* Common styles for all assets */
        .asset {
            position: absolute;
            display: block;
            image-rendering: pixelated; /* Keeps pixel art crisp */
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy smooth transition */
            cursor: pointer;
            user-select: none;
            z-index: 10;
        }

        /* Hover Effect: Scale 1.05x and bring to front slightly */
        .asset:hover {
            transform: scale(1.05);
            z-index: 100; /* Pop on top of other items when hovering */
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }

        /* --- BACKGROUND LAYERS --- */
        
        /* The main room structure (walls, floor) */
        #room-bg {
            width: 100%;
            height: 100%;
            top: 0%;
            left: 0;
            z-index: 5; /* In front of sky, behind objects */
            pointer-events: none; /* Let clicks pass through if needed */
        }

        /* The Night Sky (Behind the window) */
        #night-sky {
            width: 29%;
            top: 26%;
            left: 40%;
            z-index: 1; /* Furthest back */
        }
        #night-sky:hover {
            transform: none;
            filter: none;
        }

        /* --- OBJECT POSITIONING (Percentages relative to container) --- */

        /* == CEILING & WALLS == */
        
        #fan {
            width: 12%;
            top: 9%; /* Hanging from top */
            left: 42%;
            
            z-index: 20;
            transform-origin: top center;
        }
        /* Override hover for fan to keep it centered while scaling */
        #fan:hover {
            transform: none;
            filter: none; 
        }

        #polaroids {
            width: 22%;
            top: 18%;
            left: 18%;
            z-index: 8;
        }

        #whiteboard {
            width: 16%;
            top: 30%;
            left: 24%;
            z-index: 9;
        }
        #whiteboard:hover {
            transform: none;
            filter: none; 
        }

        #bookshelf {
            width: 14%;
            top: 22%;
            left: 2%;
            z-index: 10;
        }

        #ukulele {
            width: 5%;
            top: 35%;
            left: 18%;
            z-index: 9;
        }

        /* == LEFT FLOOR AREA == */

        #desk {
            width: 20%;
            bottom: 3%; /* Position from bottom looks better for floor items */
            left: 4%;
            z-index: 14;
        }
        #desk:hover {
            transform: none;
            filter: none; 
        }

        #monitor {
            width: 9%; /* Adjust width to fit on desk */
            bottom: 31%; /* Position relative to the desk */
            left: 8%; /* Position relative to the desk */
            z-index: 15; /* Ensure it's above the desk */
        }

        /* Small items on/near desk */
        #noodles {
            width: 4.5%;
            bottom: 29%; /* Adjusted to sit on the desk */
            left: 12%; /* Adjusted to sit on the desk */
            z-index: 16;
        }

        #ps5 {
            width: 4.5%;
            bottom: 13%;
            left: 16%;
            z-index: 15; /* Behind desk leg */
        }

        #dumbell {
            width: 8%;
            bottom: 13%;
            right: 15%;
            z-index: 16;
        }

        /* == CENTER FLOOR AREA == */

        #bean-bag {
            width: 20%;
            bottom: 15%;
            left: 27%;
            z-index: 12;
        }

        /* Override the default asset hover effect for the bean bag to prevent scaling */
        #bean-bag:hover {
            transform: none;
            filter: none;
        }

        #cyborg {
            width: 14%; /* Adjust scale based on preference */
            bottom: 12%;
            left: 55%;
            transform: translateX(-50%);
            z-index: 18; /* In front of most things */
        }
        #cyborg:hover {
             transform: translateX(-50%) scale(1.1);
        }

        /* == RIGHT WALL & FLOOR AREA == */

        #painting {
            width: 14%;
            top: 28%;
            right: 19%;
            z-index: 8;
        }

        #posters {
            width: 22%;
            top: 15%;
            right: 2%;
            z-index: 8;
        }

        #plant {
            width: 8%;
            bottom: 20%;
            right: 18%;
            z-index: 14;
        }
        #plant:hover {
            transform: none;
            filter: none; 
        }

        #dog {
            width: 17%;
            bottom: 15%;
            right: 30%;
            z-index: 15;
        }
        #dog:hover {
            transform: none;
            filter: none;
        }

        #cabinet {
            width: 13%;
            bottom: 0%;
            right: 2%;
            z-index: 16;
        }
        #cabinet:hover {
            transform: none;
            filter: none; 
        }

        #phone {
            width: 3%;
            bottom: 26%; /* Sitting on top of cabinet */
            right: 10%;
            z-index: 17;
        }

        #speaker {
            width: 3%;
            bottom: 24%; /* Sitting on top of cabinet */
            right: 5%;
            z-index: 17;
        }

        /* --- LOADING OVERLAY (Optional but nice) --- */
        #loader {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1a1a;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            transition: opacity 0.5s;
        }

        /* Dialogue Box */
        #dialogue-box {
            position: absolute;
            /* Positioning relative to the cyborg - will be adjusted by JS */
            top: 60%; 
            left: 43%;
            transform: translateX(-50%) translateY(-100%); /* Adjust to place above cyborg's mouth */
            width: 30%; /* Adjust width for the speech bubble image */
            height: 20%; /* Adjust height for the speech bubble image */
            background-image: url('assets/dialogue box.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            display: flex; /* Use flexbox for centering text */
            justify-content: center;
            align-items: center;
            padding-bottom: 4%; /* Adjust padding to fit text within the bubble shape */
            padding-left: 7%;
            padding-right: 7%;
            box-sizing: border-box; /* Include padding in width/height */
            color: black; /* Text color inside the dialogue box */
            font-size: 1em; /* Adjust font size to fit */
            text-align: center;
            z-index: 200; /* Above all other elements */
            visibility: hidden; /* Hidden by default, use visibility for smoother transitions */
            image-rendering: pixelated;
            font-family: 'Press Start 2P', 'Courier New', Courier, monospace; /* Use imported pixel font, fallback to monospace */
            line-height: 1.2;
        }

        #dialogue-box p {
            margin-top: 15%; /* Push text down to fit in the bubble */
            margin-bottom: 0;
            white-space: pre-wrap; /* Allows newlines from JS to render */
            max-width: 80%; /* Constrain text width */
            text-shadow: none; /* Remove text shadow */
            font-size: 0.7vw; /* Made font smaller and responsive using vw */
        }
        /* --- Hologram Styles --- */
        #phone-container {
            /* These values are taken from the original #phone styles */
            width: 4%;
            bottom: 24%;
            right: 9%;
            z-index: 18;
        }

        #phone-container #phone {
            width: 100%;
            position: static; /* The wrapper is now the positioned element */
            display: block; /* Ensure it behaves like a block element */
        }

        #hologram {
            position: absolute;
            bottom: 100%; /* Position above the phone */
            left: 50%;
            transform: translateX(-50%);
            width: 200%; /* Make it larger relative to the phone */
            aspect-ratio: 1.05 / 1; /* Match the aspect ratio of the hologram image */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            pointer-events: none; /* Can't interact with it when hidden */
            z-index: 200; /* Ensure it appears above other elements */
            image-rendering: pixelated;
        }

        #phone-container:hover #hologram {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
            pointer-events: auto; /* Allow interaction when visible */
        }

        #hologram .hologram-image {
            width: 100%;
            position: absolute;
            top: -10%;
            left: 0;
            pointer-events: none;
        }

        #hologram .hologram-link {
            position: absolute;
        }

        /* YouTube Player Container - Debug: visible */
        #youtube-player-container {
            position: absolute;
            left: -9999px; /* Off-screen */
            width: 1px;
            height: 1px;
            overflow: hidden;
            opacity: 0; /* Make visible */
            pointer-events: none; /* Make interactive */
            
        }

        /* Speaker glow effect for autoplay fallback */
        .speaker-active-feedback {
            transform: scale(1.05);
            filter: drop-shadow(0 0 8px rgba(0, 153, 255, 0.4)); /* Green glow */
            transition: transform 0.3s ease, filter 0.3s ease;
        }
    </style>
</head>
<body>

    <div id="room-container">
        
        <!-- Loader -->
        <div id="loader">Loading Assets...</div>

        <!-- Dialogue Box -->
        <div id="dialogue-box" class="pixel-font">
            <p id="dialogue-text"></p>
        </div>

        <!-- YouTube Player Container -->
        <div id="youtube-player-container"></div>

        <!-- 1. Backgrounds -->
        <!-- Note: Ensure "night sky.png" is placed properly. It sits behind the window of "room.png" -->
        <img src="assets/night sky.gif" id="night-sky" class="asset" alt="Night Sky">
        <img src="assets/room2.png" id="room-bg" class="asset" alt="Room Background">

        <!-- 2. Ceiling & Upper Walls -->
        <img src="assets/fan1.png" id="fan" class="asset" alt="Ceiling Fan">
        <img src="assets/polaroids1.png" id="polaroids" class="asset" alt="Polaroid Photos">
        <img src="assets/posters1.png" id="posters" class="asset" alt="Movie Posters">
        <img src="assets/painting1.png" id="painting" class="asset" alt="Starry Night Painting">
        <img src="assets/whiteboard1.png" id="whiteboard" class="asset" alt="Whiteboard">
        <img src="assets/bookshelf1.png" id="bookshelf" class="asset" alt="Bookshelf">
        <img src="assets/ukulele1.png" id="ukulele" class="asset" alt="Ukulele">

        <!-- 3. Floor & Furniture -->
        <img src="assets/desk.png" id="desk" class="asset" alt="Computer Desk">
        <img src="assets/monitor.png" id="monitor" class="asset" alt="Computer Monitor">
        <img src="assets/noodles1.png" id="noodles" class="asset" alt="Cup Noodles">
        <img src="assets/ps5 pixelated1.png" id="ps5" class="asset" alt="PS5 Console">
        <img src="assets/dumbell1.png" id="dumbell" class="asset" alt="Dumbbell">
        
        <img src="assets/bean bag2.png" id="bean-bag" class="asset" alt="Bean Bag Chair with Cyborg">
        
        <!-- Character - Removed as it's part of the bean-bag image now -->

        <img src="assets/plant1.png" id="plant" class="asset" alt="House Plant">
        <img src="assets/dog.gif" id="dog" class="asset" alt="Sleeping Dog">
        
        <img src="assets/cabinet1.png" id="cabinet" class="asset" alt="Wooden Cabinet">
        <div id="phone-container" class="asset">
            <img src="assets/phone1.png" id="phone" alt="Smartphone">
            <div id="hologram">
                <img src="assets/hologram1.png" class="hologram-image" alt="Hologram Links">
                <a href="https://github.com/Paradox-73" target="_blank" class="hologram-link" style="top: 0; left: 0; width: 50%; height: 50%;" title="GitHub"></a>
                <a href="resume.pdf" target="_blank" class="hologram-link" style="top: 0; left: 50%; width: 50%; height: 50%;" title="Resume"></a>
                <a href="mailto:kanavbhardwaj5150@gmail.com" class="hologram-link" style="top: 50%; left: 0; width: 50%; height: 50%;" title="Email"></a>
                <a href="https://www.linkedin.com/in/kanav-bhardwaj-a25940281/" target="_blank" class="hologram-link" style="top: 50%; left: 50%; width: 50%; height: 50%;" title="LinkedIn"></a>
            </div>
        </div>
        <img src="assets/speaker1.png" id="speaker" class="asset" alt="Speaker">

    </div>

    <!-- YouTube IFrame API script -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // Global YouTube player variable
        let player;
        let autoplayBlockedMessageActive = false; // Flag to track if the fallback message is displayed

        // Function to show dialogue (global scope)
        function showDialogue(message) {
            const dialogueBox = document.getElementById('dialogue-box');
            const dialogueText = document.getElementById('dialogue-text');
            if (dialogueText && dialogueBox) {
                dialogueText.textContent = message;
                dialogueBox.style.visibility = 'visible';
                dialogueBox.style.opacity = '1';
            }
        }

        // Function to hide dialogue (global scope)
        function hideDialogue() {
            const dialogueBox = document.getElementById('dialogue-box');
            if (dialogueBox) {
                dialogueBox.style.opacity = '0';
                dialogueBox.style.visibility = 'hidden';
            }
        }

        // This function will be called when the YouTube IFrame API is ready
        function onYouTubeIframeAPIReady() {
            console.log("YouTube IFrame API is ready. Initializing player.");
            player = new YT.Player('youtube-player-container', {
                videoId: 'yajJ_QVIKwU', // The extracted video ID from https://youtu.be/t8NqwxeGVyY
                playerVars: {
                    'autoplay': 1,      // Autoplay the video
                    'controls': 0,      // Hide player controls
                    'loop': 1,          // Loop the video
                    'modestbranding': 1, // Remove YouTube logo
                    'showinfo': 0,      // Hide video title and uploader info
                    'rel': 0,           // Do not show related videos
                    'disablekb': 1,     // Disable keyboard controls
                    'fs': 0,            // Disable fullscreen button
                    'iv_load_policy': 3, // Do not show video annotations
                    'playlist': 'yajJ_QVIKwU', // Required for looping single video
                    'origin': window.location.origin // Crucial for local development CORS issues
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // This function fires once the video player is ready
        function onPlayerReady(event) {
            console.log("Player is ready. Attempting to play video.");
            event.target.playVideo();
            event.target.setVolume(50); // Ensure volume is set to a reasonable level

            // Give it a moment to try autoplay and then check its state
            setTimeout(() => {
                const playerState = event.target.getPlayerState();
                const speaker = document.getElementById('speaker'); // Get speaker here for check

                console.log(`Initial player state after 1s: ${playerState}, isMuted: ${event.target.isMuted()}`);

                // If not playing, or if it's playing but muted due to policy, then autoplay failed user expectation
                if (playerState !== YT.PlayerState.PLAYING || (playerState === YT.PlayerState.PLAYING && event.target.isMuted())) {
                    autoplayBlockedMessageActive = true;
                    if (speaker) {
                        speaker.classList.add('speaker-active-feedback'); // Add a class for visual feedback
                    }
                    event.target.mute(); // Ensure it's muted if it started playing silently
                    console.log("Autoplay blocked. Fallback message will be displayed after welcome messages.");
                } else {
                    // Autoplay successful and unmuted, music is playing
                    autoplayBlockedMessageActive = false;
                    hideDialogue(); // Ensure dialogue is hidden if it was showing for other reasons
                    console.log("Autoplay successful. Music playing.");
                }
            }, 1000); // 1 second to allow autoplay to attempt and browser to set state
        }

        // This function fires when the player's state changes
        function onPlayerStateChange(event) {
            console.log(`Player state changed to: ${event.data}`);
            // We can add logic here if needed for state changes, e.g., if video ends, ensure it loops.
            // However, 'loop: 1' and 'playlist: VIDEO_ID' in playerVars should handle looping.
        }

        window.onload = function() {
            const loader = document.getElementById('loader');
            const dialogueBox = document.getElementById('dialogue-box'); // Reintroduced
            const dialogueText = document.getElementById('dialogue-text'); // Reintroduced
            const beanBag = document.getElementById('bean-bag'); // The cyborg on the bean bag
            const speaker = document.getElementById('speaker'); // Get the speaker element once here

            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 500);

            // Initial welcome message sequence
            const welcomeMessages = [
                "Welcome to my digital room. I'm Kanav.",
                "Every item here tells a story, and some lead to pages I've crafted.",
                "Hover over objects that subtly shift, then click to explore them!"
            ];
            const messageDisplayDuration = 4000; // 2 seconds per message

            let currentMessageIndex = 0;

            function displayNextWelcomeMessage() {
                if (currentMessageIndex < welcomeMessages.length) {
                    showDialogue(welcomeMessages[currentMessageIndex]);
                    currentMessageIndex++;
                    setTimeout(displayNextWelcomeMessage, messageDisplayDuration);
                } else {
                    hideDialogue();
                    beanBag.src = 'assets/bean bag2.png'; // Revert bean bag after welcome sequence
                    // After welcome messages, check if autoplay was blocked and display the message
                    if (autoplayBlockedMessageActive) {
                        showDialogue("Autoplay blocked. Click the speaker for ambient music!");
                    }
                }
            }

            // Start with bean bag3 for the welcome message
            beanBag.src = 'assets/bean bag3.png';
            displayNextWelcomeMessage(); // Start the welcome message sequence

            // Preload the hover images to prevent a flash on first hover
            const hoverImageBeanBag3 = new Image();
            hoverImageBeanBag3.src = 'assets/bean bag3.png';

            const hoverImageBeanBag2 = new Image();
            hoverImageBeanBag2.src = 'assets/bean bag2.png';

            // Re-introduce bean-bag hover effect
            beanBag.addEventListener('mouseenter', () => {
                beanBag.src = 'assets/bean bag3.png';
            });
            beanBag.addEventListener('mouseleave', () => {
                // Only revert if no dialogue is active from other assets
                if (dialogueBox.style.visibility === 'hidden') { 
                    beanBag.src = 'assets/bean bag2.png';
                }
            });

            // Speaker click listener for music toggle
            if (speaker) {
                speaker.addEventListener('click', () => {
                    console.log("Speaker clicked.");
                    if (player) {
                        if (player.isMuted()) {
                            player.unMute();
                            player.setVolume(50); // Ensure volume is set upon unmuting
                            player.playVideo(); // Always attempt to play on unMute click
                            console.log("Player unmuted and playing.");
                            console.log(`State after playVideo call: ${player.getPlayerState()}, isMuted: ${player.isMuted()}`);
                        } else {
                            player.mute();
                            console.log("Player muted.");
                        }
                    }

                    // If the autoplay blocked message was active, hide it and remove speaker feedback
                    if (autoplayBlockedMessageActive) {
                        showDialogue("Music playing! Click again to mute."); // Give feedback that it's now playing
                        autoplayBlockedMessageActive = false;
                        speaker.classList.remove('speaker-active-feedback');
                        // Hide the dialogue after a short delay so it doesn't persist
                        setTimeout(hideDialogue, 2000); 
                    }
                });
            }

            // Map asset IDs to their messages and links
            const interactiveAssets = {
                'ukulele': { message: "My music journey. Click to explore my sonic world!", link: "Music.html" },
                'posters': { message: "Movie & TV shows I've enjoyed. Click to see what's on!", link: "MoviesTV.html" },
                'ps5': { message: "Dive into my gaming adventures. Click to start the quest!", link: "Games.html" },
                'painting': { message: "My art inspirations. Click to discover my fav creative works!", link: "art.html" },
                'noodles': { message: "Food: more than just fuel. Click to savor my culinary recipes!", link: "Food.html" },
                'polaroids': { message: "Travel memories and destinations. Click to journey with me!", link: "Travel.html" },
                'bookshelf': { message: "My literary escape. Click to browse my favorite reads!", link: "Literature.html" },
                'dumbell': { message: "My sports journey. Click to play the sports I have played!", link: "Sport.html" },
                'monitor': { message: "Projects I have made. Click to see my work!", link: "Projects.html" },
                'phone-container': { message: "Connect with me! Click to explore my links.", link: "#"},  // Link handled by hologram links
                'dog': { message: "Don't disturb him." }
            };

            const assets = document.querySelectorAll('.asset');
            assets.forEach(asset => {
                const assetId = asset.id;
                const assetData = interactiveAssets[assetId];

                // Only apply hover effects to interactive assets
                if (assetData) {
                    asset.addEventListener('mouseenter', () => {
                        showDialogue(assetData.message);
                    });
                    asset.addEventListener('mouseleave', () => {
                        hideDialogue();
                    });
                    asset.addEventListener('click', () => {
                        window.location.href = assetData.link;
                    });
                } else if (assetId === 'bean-bag') {
                    // Do nothing for bean-bag specific hover, as it's now controlled by others
                    // or the initial state. Its 'click' functionality is still implicitly handled if it were interactive.
                } else {
                    asset.addEventListener('click', () => {
                        console.log(`You clicked on: ${asset.alt}`);
                    });
                }
            });
        };
    </script>
</body>
</html>